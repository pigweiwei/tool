<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iPhone 风格滚轮分仓计算器</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f0f0f0;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 30px;
}

.result {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 20px;
}

.wheel-container {
    display: flex;
    gap: 40px;
    perspective: 1000px;
    margin-bottom: 20px;
}

.wheel-column {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
}

.wheel {
    width: 120px;
    height: 400px;
    overflow: hidden;
    border-radius: 20px;
    background: rgba(255,255,255,0.9);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    text-align: center;
    position: relative;
}

.wheel::before, .wheel::after {
    content: '';
    position: absolute;
    left: 0;
    width: 100%;
    height: 80px;
    pointer-events: none;
}
.wheel::before {
    top: 0;
    background: linear-gradient(to bottom, rgba(240,240,240,1), rgba(240,240,240,0));
}
.wheel::after {
    bottom: 0;
    background: linear-gradient(to top, rgba(240,240,240,1), rgba(240,240,240,0));
}

.wheel-content {
    scroll-snap-type: y mandatory;
    -webkit-overflow-scrolling: touch;
    overflow-y: scroll;
    height: 100%;
}

.wheel-content div {
    height: 80px;
    line-height: 80px;
    scroll-snap-align: center;
    font-size: 32px;
    transition: transform 0.2s, color 0.2s, opacity 0.2s;
    transform-origin: center center -40px;
}

.wheel-label {
    margin-top: 10px;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
}

.wheel-line {
    position: absolute;
    top: 50%;
    left: 0;
    width: 100%;
    height: 2px;
    background: rgba(255,77,79,0.6);
    transform: translateY(-50%);
    pointer-events: none;
}
</style>
</head>
<body>

<div class="result" id="totalProfit">总仓盈亏：0</div>

<div class="wheel-container">
    <div class="wheel-column">
        <div class="wheel" id="ratioWheel">
            <div class="wheel-content"></div>
            <div class="wheel-line"></div>
        </div>
        <div class="wheel-label">仓位</div>
    </div>
    <div class="wheel-column">
        <div class="wheel" id="multiplierWheel">
            <div class="wheel-content"></div>
            <div class="wheel-line"></div>
        </div>
        <div class="wheel-label">盈亏</div>
    </div>
</div>

<script>
// 数据
const ratios = Array.from({length:10}, (_,i)=>(1/(i+1)).toFixed(2));
const multipliers = Array.from({length:40}, (_,i)=>(0.5*(i+1)).toFixed(1));

const ratioWheel = document.querySelector('#ratioWheel .wheel-content');
const multiplierWheel = document.querySelector('#multiplierWheel .wheel-content');
const totalProfitDisplay = document.getElementById('totalProfit');

function populateWheel(wheel, items){
    items.forEach(item=>{
        const div = document.createElement('div');
        div.textContent = item;
        wheel.appendChild(div);
    });
}
populateWheel(ratioWheel, ratios);
populateWheel(multiplierWheel, multipliers);

function getSelectedIndex(wheel){
    return Math.round(wheel.scrollTop / 80);
}

function updateSelection(){
    [ratioWheel, multiplierWheel].forEach(wheel=>{
        Array.from(wheel.children).forEach((child, i)=>{
            const centerOffset = getSelectedIndex(wheel) - i;
            const scale = Math.max(0.5, 1 - Math.abs(centerOffset)*0.2);
            const opacity = Math.max(0.3, 1 - Math.abs(centerOffset)*0.3);
            const rotateX = centerOffset * 25;
            child.style.transform = `scale(${scale}) rotateX(${rotateX}deg)`;
            child.style.color = centerOffset === 0 ? '#ff4d4f' : '#000';
            child.style.fontWeight = centerOffset === 0 ? 'bold' : 'normal';
            child.style.opacity = opacity;
        });
    });

    const ratio = parseFloat(ratios[getSelectedIndex(ratioWheel)]);
    const multiplier = parseFloat(multipliers[getSelectedIndex(multiplierWheel)]);
    const profitLoss = (1 * ratio * multiplier).toFixed(2);
    totalProfitDisplay.textContent = `总仓盈亏：${profitLoss}`;
}

// 弹性缓动滚动 + 吸附效果
function elasticScroll(target, velocity){
    let pos = target.scrollTop;
    function step(){
        const damping = 0.93 + Math.min(Math.abs(velocity)/50, 0.05);
        velocity *= damping;
        pos += velocity;

        if(pos < 0){
            pos = pos*0.3;
            velocity = 0;
        } else if(pos > target.scrollHeight - target.clientHeight){
            const excess = pos - (target.scrollHeight - target.clientHeight);
            pos = (target.scrollHeight - target.clientHeight) + excess*0.3;
            velocity = 0;
        }

        target.scrollTop = pos;
        updateSelection();

        if(Math.abs(velocity) > 0.1){
            requestAnimationFrame(step);
        } else {
            // 吸附停留到最接近索引
            const index = getSelectedIndex(target);
            target.scrollTo({top: index*80, behavior: 'smooth'});
        }
    }
    requestAnimationFrame(step);
}

function attachWheel(wheel){
    let lastY = 0;
    let velocity = 0;
    let isTouching = false;
    let isMouseDown = false;

    wheel.addEventListener('touchstart', e=>{
        isTouching = true;
        lastY = e.touches[0].clientY;
        velocity = 0;
    });
    wheel.addEventListener('touchmove', e=>{
        const delta = lastY - e.touches[0].clientY;
        lastY = e.touches[0].clientY;
        wheel.scrollTop += delta;
        velocity = delta;
        updateSelection();
    });
    wheel.addEventListener('touchend', e=>{
        isTouching = false;
        elasticScroll(wheel, velocity);
    });

    wheel.addEventListener('mousedown', e=>{
        isMouseDown = true;
        lastY = e.clientY;
        velocity = 0;
    });
    window.addEventListener('mousemove', e=>{
        if(isMouseDown){
            const delta = lastY - e.clientY;
            lastY = e.clientY;
            wheel.scrollTop += delta;
            velocity = delta;
            updateSelection();
        }
    });
    window.addEventListener('mouseup', e=>{
        if(isMouseDown){
            isMouseDown = false;
            elasticScroll(wheel, velocity);
        }
    });
}

attachWheel(ratioWheel);
attachWheel(multiplierWheel);
updateSelection();
</script>
</body>
</html>
