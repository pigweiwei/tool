<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iOS 风格滚动选择器（无限循环 + 惯性）</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    display: flex;
    height: 100vh;
    align-items: center;
    justify-content: center;
    background: #f0f0f0;
    overflow: hidden;
  }

  .picker-container {
    perspective: 1000px;
    width: 200px;
    height: 200px;
    overflow: hidden;
    position: relative;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .picker-list {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    transition: transform 0.2s ease-out;
  }

  .picker-item {
    height: 40px;
    line-height: 40px;
    text-align: center;
    font-size: 18px;
    color: #666;
    user-select: none;
  }

  .picker-item.selected {
    color: #000;
    font-weight: bold;
  }

  .picker-mask {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, rgba(240,240,240,1) 0%, rgba(240,240,240,0) 30%, rgba(240,240,240,0) 70%, rgba(240,240,240,1) 100%);
    pointer-events: none;
  }

  .picker-center-line {
    position: absolute;
    top: 50%;
    left: 0;
    width: 100%;
    height: 40px;
    margin-top: -20px;
    border-top: 1px solid #ccc;
    border-bottom: 1px solid #ccc;
    pointer-events: none;
  }
</style>
</head>
<body>

<div class="picker-container">
  <div class="picker-list" id="pickerList"></div>
  <div class="picker-mask"></div>
  <div class="picker-center-line"></div>
</div>

<script>
  const items = ["苹果", "香蕉", "橙子", "西瓜", "葡萄", "菠萝", "草莓", "芒果", "樱桃", "梨"];
  const itemHeight = 40;
  const visibleCount = 5;
  const pickerList = document.getElementById('pickerList');

  // 无限循环：复制前后各一份
  const extendedItems = [...items, ...items, ...items];
  extendedItems.forEach(text => {
    const div = document.createElement('div');
    div.className = 'picker-item';
    div.innerText = text;
    pickerList.appendChild(div);
  });

  let currentIndex = items.length; // 初始为中间一组的第一个
  const totalItems = extendedItems.length;

  function updatePicker(animate = true) {
    if(animate) pickerList.style.transition = 'transform 0.2s ease-out';
    else pickerList.style.transition = 'none';
    const offset = -currentIndex * itemHeight + Math.floor(visibleCount / 2) * itemHeight;
    pickerList.style.transform = `translateY(${offset}px)`;

    document.querySelectorAll('.picker-item').forEach((el, idx) => {
      el.classList.toggle('selected', idx === currentIndex);
    });
  }

  updatePicker(false);

  // 无限循环调整
  function adjustLoop() {
    if(currentIndex < items.length) currentIndex += items.length;
    if(currentIndex >= items.length*2) currentIndex -= items.length;
    updatePicker(false);
  }

  // 拖动惯性
  let startY = 0;
  let startTime = 0;
  let isDragging = false;
  let velocity = 0;
  let momentumId;

  function startDrag(e) {
    cancelAnimationFrame(momentumId);
    isDragging = true;
    startY = e.touches ? e.touches[0].clientY : e.clientY;
    startTime = Date.now();
    velocity = 0;
  }

  function moveDrag(e) {
    if(!isDragging) return;
    e.preventDefault();
    const y = e.touches ? e.touches[0].clientY : e.clientY;
    const delta = y - startY;
    if(Math.abs(delta) >= itemHeight/2) {
      const step = delta / itemHeight;
      currentIndex -= step;
      startY = y;
      updatePicker(false);
    }
    const now = Date.now();
    velocity = (y - startY) / (now - startTime + 1);
    startTime = now;
  }

  function endDrag() {
    if(!isDragging) return;
    isDragging = false;

    // 惯性滚动
    let momentum = velocity * 200; // 放大惯性
    if(Math.abs(momentum) < 0.5) momentum = 0;
    const steps = Math.round(momentum);
    if(steps !== 0) {
      currentIndex -= steps;
      adjustLoop();
      updatePicker();
    } else {
      adjustLoop();
      updatePicker();
    }
  }

  pickerList.addEventListener('mousedown', startDrag);
  pickerList.addEventListener('mousemove', moveDrag);
  pickerList.addEventListener('mouseup', endDrag);
  pickerList.addEventListener('mouseleave', endDrag);
  pickerList.addEventListener('touchstart', startDrag);
  pickerList.addEventListener('touchmove', moveDrag, {passive:false});
  pickerList.addEventListener('touchend', endDrag);

  // 滚轮也支持
  pickerList.addEventListener('wheel', function(e){
    e.preventDefault();
    currentIndex += e.deltaY > 0 ? 1 : -1;
    adjustLoop();
    updatePicker();
  }, {passive:false});

</script>
</body>
</html>
