<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>深色 iOS 风格滚动选择器</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    background: #121212;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .picker-container {
    width: 200px;
    height: 200px;
    overflow: hidden;
    position: relative;
    background: #1e1e1e;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.6);
    touch-action: none;
  }

  .picker-list {
    position: absolute;
    width: 100%;
    top: 0;
    left: 0;
  }

  .picker-item {
    height: 40px;
    line-height: 40px;
    text-align: center;
    font-size: 18px;
    color: #aaa;
    user-select: none;
  }

  .picker-item.selected {
    color: #fff;
    font-weight: bold;
  }

  .picker-mask {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, rgba(18,18,18,1) 0%, rgba(18,18,18,0) 30%, rgba(18,18,18,0) 70%, rgba(18,18,18,1) 100%);
    pointer-events: none;
  }

  .picker-center-line {
    position: absolute;
    top: 50%;
    left: 0;
    width: 100%;
    height: 40px;
    margin-top: -20px;
    border-top: 1px solid #555;
    border-bottom: 1px solid #555;
    pointer-events: none;
  }
</style>
</head>
<body>

<div class="picker-container">
  <div class="picker-list" id="pickerList"></div>
  <div class="picker-mask"></div>
  <div class="picker-center-line"></div>
</div>

<script>
const items = ["苹果","香蕉","橙子","西瓜","葡萄","菠萝","草莓","芒果","樱桃","梨"];
const itemHeight = 40;
const pickerList = document.getElementById('pickerList');

// 无限循环：前后各复制一份
const extendedItems = [...items, ...items, ...items];
extendedItems.forEach(text=>{
  const div = document.createElement('div');
  div.className = 'picker-item';
  div.innerText = text;
  pickerList.appendChild(div);
});

let currentIndex = items.length; // 初始在中间组第一个
let startY = 0;
let lastY = 0;
let startTime = 0;
let velocity = 0;
let isDragging = false;
let animationFrameId = null;

function updatePicker(animate = true){
  pickerList.style.transition = animate ? 'transform 0.2s cubic-bezier(.1, .57, .1, 1)' : 'none';
  const offset = -currentIndex*itemHeight + Math.floor(5/2)*itemHeight;
  pickerList.style.transform = `translateY(${offset}px)`;
  document.querySelectorAll('.picker-item').forEach((el, idx)=>{
    el.classList.toggle('selected', idx === currentIndex);
  });
}

function adjustLoop(){
  if(currentIndex < items.length) currentIndex += items.length;
  if(currentIndex >= items.length*2) currentIndex -= items.length;
  updatePicker(false);
}

function momentumScroll(){
  velocity *= 0.95;
  if(Math.abs(velocity) < 0.02){
    currentIndex = Math.round(currentIndex - velocity);
    adjustLoop();
    updatePicker();
    return;
  }
  currentIndex -= velocity;
  adjustLoop();
  updatePicker(false);
  animationFrameId = requestAnimationFrame(momentumScroll);
}

// 拖拽事件
function startDrag(e){
  cancelAnimationFrame(animationFrameId);
  isDragging = true;
  startY = e.touches ? e.touches[0].clientY : e.clientY;
  lastY = startY;
  startTime = Date.now();
  velocity = 0;
}

function moveDrag(e){
  if(!isDragging) return;
  e.preventDefault();
  const y = e.touches ? e.touches[0].clientY : e.clientY;
  const delta = y - lastY;
  currentIndex -= delta/itemHeight;
  updatePicker(false);

  const now = Date.now();
  velocity = delta / (now - startTime) * 16; // 修正帧率影响
  startTime = now;
  lastY = y;
}

function endDrag(){
  if(!isDragging) return;
  isDragging = false;
  momentumScroll();
}

pickerList.addEventListener('mousedown', startDrag);
pickerList.addEventListener('mousemove', moveDrag);
pickerList.addEventListener('mouseup', endDrag);
pickerList.addEventListener('mouseleave', endDrag);
pickerList.addEventListener('touchstart', startDrag);
pickerList.addEventListener('touchmove', moveDrag, {passive:false});
pickerList.addEventListener('touchend', endDrag);

// 鼠标滚轮支持
pickerList.addEventListener('wheel', e=>{
  e.preventDefault();
  currentIndex += e.deltaY>0?1:-1;
  adjustLoop();
  updatePicker();
},{passive:false});

// 初始化
updatePicker(false);
</script>

</body>
</html>
