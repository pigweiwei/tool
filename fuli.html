<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>仿 iPhone 滚轮</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #111;
    color: #fff;
    margin: 0;
  }

  .picker {
    position: relative;
    width: 120px;
    height: 200px; /* 可见窗口 */
    overflow: hidden;
    border-radius: 12px;
    background: #222;
    touch-action: none; /* 禁止默认页面滚动 */
  }

  .picker ul {
    list-style: none;
    padding: 0;
    margin: 0;
    transition: transform 0.2s ease-out;
    will-change: transform;
  }

  .picker li {
    height: 45px;   /* 原 40px × 1.8 ≈ 72，但为了平衡调成 45 */
    line-height: 45px;
    text-align: center;
    font-size: 20px;
    opacity: 0.4;
    transition: all 0.15s;
  }

  .picker li.active {
    font-size: 26px;
    font-weight: bold;
    opacity: 1;
    color: #4CAF50;
  }

  .picker::after {
    content: "";
    position: absolute;
    top: 78px;
    left: 0;
    right: 0;
    height: 45px;
    border-top: 2px solid #4CAF50;
    border-bottom: 2px solid #4CAF50;
    pointer-events: none;
  }
</style>
</head>
<body>

<div class="picker" id="picker">
  <ul id="list"></ul>
</div>

<script>
const picker = document.getElementById("picker");
const list = document.getElementById("list");

const values = [];
for (let v = 0.5; v <= 50; v += 0.5) {
  values.push(v.toFixed(1));
}
values.forEach(v => {
  const li = document.createElement("li");
  li.textContent = v;
  list.appendChild(li);
});

const items = list.querySelectorAll("li");

let startY = 0, offsetY = 0, velocity = 0, animationFrame;
const itemHeight = 45;
let currentIndex = 1; // 默认选中 1.0

updateActive();

// 触摸开始
picker.addEventListener("touchstart", e => {
  cancelAnimationFrame(animationFrame);
  startY = e.touches[0].clientY - offsetY;
  velocity = 0;
  list.style.transition = "none";
}, { passive: false });

// 触摸移动
picker.addEventListener("touchmove", e => {
  e.preventDefault();
  const y = e.touches[0].clientY - startY;
  velocity = y - offsetY; // 计算速度
  offsetY = y;
  list.style.transform = `translateY(${offsetY}px)`;
  updateActive(); // 👉 动态高亮
}, { passive: false });

// 触摸结束，惯性滚动
picker.addEventListener("touchend", () => {
  function momentum() {
    offsetY += velocity;
    velocity *= 0.92; // 摩擦力

    // 边界处理
    if (offsetY > 0) {
      offsetY = 0;
      velocity = 0;
    }
    const minOffset = -(items.length - 1) * itemHeight;
    if (offsetY < minOffset) {
      offsetY = minOffset;
      velocity = 0;
    }

    list.style.transform = `translateY(${offsetY}px)`;
    updateActive();

    if (Math.abs(velocity) > 0.5) {
      animationFrame = requestAnimationFrame(momentum);
    } else {
      // 自动吸附到最近的刻度
      currentIndex = Math.round(-offsetY / itemHeight);
      offsetY = -currentIndex * itemHeight;
      list.style.transition = "transform 0.2s ease-out";
      list.style.transform = `translateY(${offsetY}px)`;
      updateActive();
    }
  }
  momentum();
});

function updateActive() {
  const center = picker.clientHeight / 2;
  let closestIndex = 0;
  let closestDistance = Infinity;

  items.forEach((li, i) => {
    const itemCenter = offsetY + i * itemHeight + itemHeight / 2;
    const distance = Math.abs(center - itemCenter);
    if (distance < closestDistance) {
      closestDistance = distance;
      closestIndex = i;
    }
  });

  items.forEach((li, i) => {
    li.classList.toggle("active", i === closestIndex);
  });
}
</script>

</body>
</html>
