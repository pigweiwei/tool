<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iOS 风格滚轮</title>
<style>
html, body { margin:0; height:100%; overflow:hidden; background:#111; font-family:sans-serif; display:flex; justify-content:center; align-items:center;}
.picker-container { position:relative; height:400px; width:140px; overflow:hidden; touch-action:none; perspective: 800px; }
.picker-list { position:absolute; top:0; left:0; right:0; transform-style: preserve-3d; }
.picker-item { height:70px; display:flex; justify-content:center; align-items:center; font-size:28px; color:#aaa; transition: all 0.1s; }
.selected-bar { position:absolute; top:50%; transform:translateY(-50%); left:0; right:0; height:70px; background: rgba(30,144,255,0.2); pointer-events:none; border-radius:8px; z-index:10;}
.spacer { height:200px; }
.mask-top, .mask-bottom { position:absolute; left:0; width:100%; height:100px; z-index:5; pointer-events:none;}
.mask-top { top:0; background: linear-gradient(to bottom, #111 0%, transparent 100%);}
.mask-bottom { bottom:0; background: linear-gradient(to top, #111 0%, transparent 100%);}
.picker-container::before, .picker-container::after { content:""; position:absolute; top:0; width:30px; height:100%; z-index:5; pointer-events:none;}
.picker-container::before { left:0; background: linear-gradient(to right, #111, transparent); }
.picker-container::after { right:0; background: linear-gradient(to left, #111, transparent); }
</style>
</head>
<body>
<div class="picker-container" id="picker">
  <div class="picker-list" id="pickerList"></div>
  <div class="selected-bar"></div>
  <div class="mask-top"></div>
  <div class="mask-bottom"></div>
</div>

<audio id="tickSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>

<script>
(function(){
const picker=document.getElementById('picker');
const list=document.getElementById('pickerList');
const tickSound=document.getElementById('tickSound');
const itemHeight=70;
const min=0.5,max=50,step=0.5;
const values=[]; for(let v=min;v<=max;v+=step) values.push(v.toFixed(1));

list.innerHTML='<div class="spacer"></div>'+values.map(v=>`<div class="picker-item">${v}</div>`).join('')+'<div class="spacer"></div>';
const items=list.querySelectorAll('.picker-item');
let offset=-itemHeight*2,startY=0,velocity=0,lastTickIndex=null,animFrame,lastTime=0;

function updateHighlight(){
    const center=picker.clientHeight/2;
    let closestItem=null,closestDist=Infinity;
    items.forEach((item,i)=>{
        const itemCenter=item.offsetTop+itemHeight/2+offset;
        const dist=center-itemCenter;
        const absDist=Math.abs(dist);
        const scale=Math.max(0.7,1-absDist/200);
        const rotateX=Math.max(-40, Math.min(40, dist/5));
        const colorVal=Math.round(Math.max(170,255-absDist/2));
        item.style.transform=`scale(${scale}) rotateX(${rotateX}deg)`;
        if(absDist<closestDist){
            closestDist=absDist;
            closestItem=item;
            if(lastTickIndex!==i){
                lastTickIndex=i;
                tickSound.currentTime=0;
                tickSound.play().catch(()=>{});
                if(navigator.vibrate) navigator.vibrate(5);
            }
        }
        // 高亮选中
        if(absDist<itemHeight/2){
            item.style.color="#1e90ff";
            item.style.fontWeight="bold";
        }else{
            item.style.color=`rgb(${colorVal},${colorVal},${colorVal})`;
            item.style.fontWeight="normal";
        }
    });
}

function render(){ list.style.transform=`translateY(${offset}px)`; updateHighlight(); }

// 阻尼 + 弹簧 + iOS 式加速度
function damping(v){ return v*0.92; }
function spring(o){
    const maxOffset=0, minOffset=-(itemHeight*(values.length-1));
    if(o>maxOffset) return (o - maxOffset)*0.2;
    if(o<minOffset) return (o - minOffset)*0.2;
    return 0;
}

function animate(){
    const springForce = spring(offset);
    offset += velocity - springForce;
    // iOS 式非线性阻尼（快速滚动加速）
    velocity = Math.sign(velocity) * Math.pow(Math.abs(velocity)*0.92,1.05);
    render();
    if(Math.abs(velocity)>0.5 || Math.abs(springForce)>0.5) animFrame=requestAnimationFrame(animate);
    else{
        let index=Math.round(-offset/itemHeight);
        offset=-index*itemHeight;
        render();
    }
}

picker.addEventListener('touchstart', e=>{
    cancelAnimationFrame(animFrame);
    startY=e.touches[0].clientY;
    velocity=0;
    lastTime=Date.now();
}, {passive:true});

picker.addEventListener('touchmove', e=>{
    const y=e.touches[0].clientY;
    const now=Date.now();
    const dt=now-lastTime;
    lastTime=now;
    const delta=y-startY;
    startY=y;
    offset+=delta;
    velocity = delta/(dt/16);
    render();
}, {passive:true});

picker.addEventListener('touchend', ()=>{
    animFrame=requestAnimationFrame(animate);
});

render();
})();
</script>
</body>
</html>
