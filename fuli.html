<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>仿 iOS 3D 滚轮选择器</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body, html { width:100%; height:100%; font-family:Arial,sans-serif; background:#f5f5f5; display:flex; justify-content:center; align-items:center; overflow:hidden; }

.picker-container {
  perspective: 1000px;
  width: 200px;
  height: 200px;
  overflow: hidden;
  position: relative;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  touch-action: none; /* 阻止默认滑动 */
}

.picker-wheel {
  list-style:none;
  padding:0;
  margin:0;
  position:absolute;
  width:100%;
  height:100%;
  top:50%;
  transform-style: preserve-3d;
  transform: translateY(-50%);
  transition: transform 0.2s cubic-bezier(.25,.1,.25,1);
}

.picker-wheel li {
  text-align:center;
  height: 40px;
  line-height:40px;
  font-size:18px;
  color:#888;
  position:absolute;
  width:100%;
  left:0;
  top:50%;
  transform-origin: center -80px;
  transition: color 0.2s, font-size 0.2s;
}

.picker-wheel li.active {
  color:#000;
  font-weight:bold;
  font-size:20px;
}

.picker-highlight {
  position:absolute;
  top:50%;
  left:0;
  width:100%;
  height:40px;
  margin-top:-20px;
  border-top:1px solid #ccc;
  border-bottom:1px solid #ccc;
  pointer-events:none;
}
</style>
</head>
<body>

<div class="picker-container">
  <ul class="picker-wheel" id="pickerWheel"></ul>
  <div class="picker-highlight"></div>
</div>

<script>
// 生成几十个选项
const data = [];
for(let i=1; i<=50; i++){
  data.push(`选项 ${i}`);
}

const wheel = document.getElementById('pickerWheel');
const itemHeight = 40;
const radius = 80;
let selectedIndex = 0;

// 渲染滚轮
function renderWheel(){
  wheel.innerHTML = '';
  data.forEach((text,i)=>{
    const li = document.createElement('li');
    li.textContent = text;
    const angle = (i - selectedIndex) * 25;
    li.style.transform = `rotateX(${angle}deg) translateZ(${radius}px)`;
    if(i===selectedIndex) li.classList.add('active');
    wheel.appendChild(li);
  });
}
renderWheel();

// ---------------- 滑动逻辑 + 惯性 ----------------
let startY=0, lastY=0, velocity=0, isDragging=false, lastTime=0, animFrame;

function onStart(e){
  cancelAnimationFrame(animFrame);
  isDragging=true;
  startY = lastY = e.touches ? e.touches[0].clientY : e.clientY;
  lastTime = Date.now();
}

function onMove(e){
  if(!isDragging) return;
  const y = e.touches ? e.touches[0].clientY : e.clientY;
  const now = Date.now();
  const deltaY = lastY - y;
  const dt = now - lastTime;

  if(dt > 0){
    velocity = deltaY / dt; // 记录速度
  }

  if(Math.abs(deltaY) > itemHeight/2){
    if(deltaY>0 && selectedIndex<data.length-1) selectedIndex++;
    if(deltaY<0 && selectedIndex>0) selectedIndex--;
    renderWheel();
    lastY = y;
    lastTime = now;
  }
  e.preventDefault();
}

function onEnd(e){
  isDragging=false;
  // 惯性动画
  function inertia(){
    if(Math.abs(velocity) < 0.001) return; // 停止
    selectedIndex += velocity>0 ? 1 : -1;
    if(selectedIndex<0) selectedIndex=0;
    if(selectedIndex>data.length-1) selectedIndex=data.length-1;
    renderWheel();
    velocity *= 0.95; // 阻尼
    animFrame = requestAnimationFrame(inertia);
  }
  inertia();
}

wheel.addEventListener('mousedown', onStart);
wheel.addEventListener('mousemove', onMove);
wheel.addEventListener('mouseup', onEnd);
wheel.addEventListener('mouseleave', onEnd);

wheel.addEventListener('touchstart', onStart, {passive:false});
wheel.addEventListener('touchmove', onMove, {passive:false});
wheel.addEventListener('touchend', onEnd);
</script>

</body>
</html>
