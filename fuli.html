<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iPhone 风格滚轮分仓计算器</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f0f0f0;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 30px;
}

.result {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 20px;
}

.wheel-container {
    display: flex;
    gap: 40px;
    perspective: 1000px;
    margin-bottom: 20px;
}

.wheel-column {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.wheel {
    width: 120px;
    height: 400px; /* 高度加倍 */
    overflow-y: scroll;
    border-radius: 15px;
    background: rgba(255,255,255,0.9);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    scroll-snap-type: y mandatory;
    -webkit-overflow-scrolling: touch;
    text-align: center;
    position: relative;
    mask-image: linear-gradient(to bottom, transparent 10%, black 40%, black 60%, transparent 90%);
    -webkit-mask-image: linear-gradient(to bottom, transparent 10%, black 40%, black 60%, transparent 90%);
}

.wheel div {
    height: 80px; /* 高度加倍 */
    line-height: 80px;
    scroll-snap-align: center;
    font-size: 32px; /* 字号增大 */
    transition: transform 0.2s, color 0.2s, opacity 0.2s;
}

.wheel-label {
    margin-top: 10px;
    font-size: 18px;
    font-weight: bold;
}

</style>
</head>
<body>

<!-- 总仓盈亏显示在最上方 -->
<div class="result" id="totalProfit">总仓盈亏：0</div>

<div class="wheel-container">
    <!-- 左侧滚轮列 -->
    <div class="wheel-column">
        <div id="ratioWheel" class="wheel"></div>
        <div class="wheel-label">仓位</div>
    </div>

    <!-- 右侧滚轮列 -->
    <div class="wheel-column">
        <div id="multiplierWheel" class="wheel"></div>
        <div class="wheel-label">盈亏</div>
    </div>
</div>

<script>
// 数据
const ratios = Array.from({length:10}, (_,i)=>(1/(i+1)).toFixed(2));
const multipliers = Array.from({length:40}, (_,i)=>(0.5*(i+1)).toFixed(1));

const ratioWheel = document.getElementById('ratioWheel');
const multiplierWheel = document.getElementById('multiplierWheel');
const totalProfitDisplay = document.getElementById('totalProfit');

function populateWheel(wheel, items){
    items.forEach(item=>{
        const div = document.createElement('div');
        div.textContent = item;
        wheel.appendChild(div);
    });
}
populateWheel(ratioWheel, ratios);
populateWheel(multiplierWheel, multipliers);

// 获取选中索引
function getSelectedIndex(wheel){
    return Math.round(wheel.scrollTop / 80); // 对应高度80
}

// 更新滚轮视觉效果和总仓盈亏
function updateSelection(){
    [ratioWheel, multiplierWheel].forEach(wheel=>{
        Array.from(wheel.children).forEach((child, i)=>{
            const centerOffset = Math.abs(getSelectedIndex(wheel) - i);
            const scale = Math.max(0.5, 1 - centerOffset*0.2);
            const opacity = Math.max(0.3, 1 - centerOffset*0.3);
            child.style.transform = `scale(${scale})`;
            child.style.color = centerOffset === 0 ? '#ff4d4f' : '#000';
            child.style.fontWeight = centerOffset === 0 ? 'bold' : 'normal';
            child.style.opacity = opacity;
        });
    });

    const ratio = parseFloat(ratios[getSelectedIndex(ratioWheel)]);
    const multiplier = parseFloat(multipliers[getSelectedIndex(multiplierWheel)]);
    const profitLoss = (1 * ratio * multiplier).toFixed(2);
    totalProfitDisplay.textContent = `总仓盈亏：${profitLoss}`;
}

// 阻尼惯性滚动与自动对齐
function attachWheel(wheel){
    let isScrolling;
    wheel.addEventListener('scroll', ()=>{
        window.clearTimeout(isScrolling);
        updateSelection();
        isScrolling = setTimeout(()=>{
            wheel.scrollTo({
                top: getSelectedIndex(wheel)*80, // 对应高度80
                behavior: 'smooth'
            });
            updateSelection();
        }, 100);
    });
}

attachWheel(ratioWheel);
attachWheel(multiplierWheel);

// 初始化
updateSelection();
</script>
</body>
</html>
