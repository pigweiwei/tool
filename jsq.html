<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>盈亏比&胜率</title>
<style>
body.dark {
  --bg-gradient: linear-gradient(135deg, #1a1a1a, #2b2b2b);
  --bar-profit-bg: rgba(0,123,255,0.35);
  --bar-profit-border: rgba(0,123,255,0.6);
  --bar-breakeven-bg: rgba(40,167,69,0.35);
  --bar-breakeven-border: rgba(40,167,69,0.6);
  --bar-right1-bg: rgba(153,102,255,0.35);
  --bar-right1-border: rgba(153,102,255,0.6);
  --bar-right2-bg: rgba(255,193,7,0.35);
  --bar-right2-border: rgba(255,193,7,0.6);
  --bar-right3-bg: rgba(220,53,69,0.35);
  --bar-right3-border: rgba(220,53,69,0.6);
  --bar-right4-bg: rgba(0,123,255,0.35);
  --bar-right4-border: rgba(0,123,255,0.6);
  --bar-right5-bg: rgba(40,167,69,0.35);
  --bar-right5-border: rgba(40,167,69,0.6);
  --label-color: #eee;
  --bar-value-color: #fff;
  --nav-color: #fff;
}
body.light {
  --bg-gradient: linear-gradient(135deg, #e0e0e0, #f5f5f5);
  --bar-profit-bg: rgba(0,123,255,0.5);
  --bar-profit-border: rgba(0,123,255,0.8);
  --bar-breakeven-bg: rgba(40,167,69,0.5);
  --bar-breakeven-border: rgba(40,167,69,0.8);
  --bar-right1-bg: rgba(153,102,255,0.5);
  --bar-right1-border: rgba(153,102,255,0.8);
  --bar-right2-bg: rgba(255,193,7,0.5);
  --bar-right2-border: rgba(255,193,7,0.8);
  --bar-right3-bg: rgba(220,53,69,0.5);
  --bar-right3-border: rgba(220,53,69,0.8);
  --bar-right4-bg: rgba(0,123,255,0.5);
  --bar-right4-border: rgba(0,123,255,0.8);
  --bar-right5-bg: rgba(40,167,69,0.5);
  --bar-right5-border: rgba(40,167,69,0.8);
  --label-color: #333;
  --bar-value-color: #000;
  --nav-color: #000;
}

body{
  margin:0; padding:0; font-family:Arial; height:100vh;
  display:flex; background:var(--bg-gradient); overflow:hidden;
}

/* 左右面板布局 */
.left-panel { width:30%; height:100%; display:flex; align-items:flex-end; justify-content:center; border-right:2px dashed #888; position:relative; }
.right-panel { width:70%; height:100%; display:flex; align-items:flex-end; justify-content:center; position:relative; }

/* 左侧盈亏平衡器 */
#leftCalc {
  position: absolute; top:100px; left:50%; transform: translateX(-50%);
  font-size:16px; font-weight:bold; color:#fff; padding:12.8px 50px; min-width:140px;
  text-align:center; border-radius:30px; background: rgba(60,60,60,0.3);
  backdrop-filter: blur(16px) saturate(160%); border:1px solid rgba(255,255,255,0.15);
  box-shadow:0 0 5px rgba(0,0,0,0.4), inset 0 0 5px rgba(255,255,255,0.05); pointer-events:none; z-index:100;
}

/* 右侧终值 */
#calcResult {
  position: absolute; top:100px; left:50%; transform: translateX(-50%);
  font-size:18px; font-weight:bold; color:#fff; padding:12.8px 50px; min-width:140px;
  text-align:center; border-radius:30px; background: rgba(60,60,60,0.3);
  backdrop-filter: blur(16px) saturate(160%); border:1px solid rgba(255,255,255,0.15);
  box-shadow:0 0 5px rgba(0,0,0,0.4), inset 0 0 5px rgba(255,255,255,0.05); pointer-events:none; z-index:100;
}

/* 柱子布局 */
.bar-container{ display:flex; align-items:flex-end; gap:80px; height:100%; }
.bar-wrapper{ position: relative; display:flex; flex-direction:column; align-items:center; justify-content:flex-end; height:100%; cursor:grab; }
.bar{
  width:150px; height:0; border-radius:20px 20px 0 0;
  display:flex; justify-content:center; align-items:flex-start; flex-direction:column;
  box-shadow: inset 0 -5px 15px rgba(0,0,0,0.1), 0 8px 20px rgba(0,0,0,0.2);
  backdrop-filter: blur(15px); transition: all 0.3s; overflow:visible; position: relative;
}
.label { margin-top:10px; font-size:16px; font-weight:bold; color:#fff; }
.bar-value{ position: absolute; top:-20px; left:50%; transform: translateX(-50%); font-size:16px; font-weight:bold; color:#fff; z-index:2; }

/* 右侧各柱子背景 */
#profitLoss { background: var(--bar-profit-bg); border:1px solid var(--bar-profit-border); }
#breakeven { background: var(--bar-breakeven-bg); border:1px solid var(--bar-breakeven-border); }
#rightBar1 { background: var(--bar-right1-bg); border:1px solid var(--bar-right1-border); }
#rightBar2 { background: var(--bar-right2-bg); border:1px solid var(--bar-right2-border); }
#rightBar3 { background: var(--bar-right3-bg); border:1px solid var(--bar-right3-border); }
#rightBar4 { background: var(--bar-right4-bg); border:1px solid var(--bar-right4-border); }
#rightBar5 { background: var(--bar-right5-bg); border:1px solid var(--bar-right5-border); }

/* 导航栏样式 */
.nav{
  position: fixed; right:0; top:50%; transform:translateY(-50%);
  width:40px; background: rgba(0,0,0,0.4); border-radius:8px 0 0 8px;
  overflow:hidden; transition: width 0.3s, background 0.3s; z-index:1000;
}
.nav:hover { width:180px; }
.nav ul { list-style:none; margin:0; padding:10px 0; }
.nav li { height:40px; position:relative; cursor:pointer; transition:background 0.3s; }
.nav li:hover { background: rgba(255,255,255,0.2); }
body.light .nav li:hover { background: rgba(0,0,0,0.1); }
.nav li a {
  display:block; width:100%; height:100%; line-height:40px; text-decoration:none; text-align:center;
  white-space:nowrap; overflow:hidden; color: var(--nav-color); font-weight:normal; transition:all 0.3s;
}
.nav li a::before { content: attr(data-short); display:inline-block; width:100%; text-align:center; }
.nav:hover li a::before { content: attr(data-full); }

</style>
</head>
<body class="dark">

<div class="left-panel">
  <div class="calc-result" id="leftCalc">盈亏平衡器</div>
  <div class="bar-container">
    <div class="bar-wrapper">
      <div class="bar" id="profitLoss"><div class="bar-value" id="profitValue">3.0</div></div>
      <div class="label">盈亏比</div>
    </div>
    <div class="bar-wrapper">
      <div class="bar" id="breakeven"><div class="bar-value" id="breakevenValue">27.3%</div></div>
      <div class="label">胜率</div>
    </div>
  </div>
</div>

<div class="right-panel">
  <div class="calc-result" id="calcResult">0</div>
  <div class="bar-container">
    <div class="bar-wrapper"><div class="bar" id="rightBar1"><div class="bar-value" id="val1">1</div></div><div class="label">本金</div></div>
    <div class="bar-wrapper"><div class="bar" id="rightBar2"><div class="bar-value" id="val2">5%</div></div><div class="label">每次止损</div></div>
    <div class="bar-wrapper"><div class="bar" id="rightBar3"><div class="bar-value" id="val3">10</div></div><div class="label">交易笔数</div></div>
    <div class="bar-wrapper"><div class="bar" id="rightBar4"><div class="bar-value" id="val4">2</div></div><div class="label">盈亏比</div></div>
    <div class="bar-wrapper"><div class="bar" id="rightBar5"><div class="bar-value" id="val5">50%</div></div><div class="label">胜率</div></div>
  </div>
</div>

<!-- 导航栏 HTML -->
<div class="nav">
  <ul>
    <li><a href="#" data-short="首" data-full="首页"></a></li>
    <li><a href="复利计算器.html" data-short="复" data-full="复利计算器"></a></li>
    <li><a href="仓位计算器.html" data-short="盈" data-full="仓位计算器"></a></li>
    <li><a href="#" id="modeToggle" data-short="浅" data-full="浅色模式"></a></li>
  </ul>
</div>

<script>
// 万分位格式化函数
function formatTenThousand(num){
  const parts = num.toFixed(2).split('.');
  let intPart = parts[0];
  const decimalPart = parts[1];
  let result = '';
  while(intPart.length > 4){
    result = ',' + intPart.slice(-4) + result;
    intPart = intPart.slice(0, -4);
  }
  result = intPart + result;
  return result + '.' + decimalPart;
}

// 左侧柱子逻辑
const profitBar = { bar: document.getElementById('profitLoss'), display: document.getElementById('profitValue'), value:3, step:0.5, max:10, type:'float', id:'profit' };
const breakevenBar = { bar: document.getElementById('breakeven'), display: document.getElementById('breakevenValue'), value:27.3, step:1, max:100, type:'percent', id:'breakeven' };
function updateHeight(bar,valueDisplay,value,maxVal,type){
  const container = bar.parentElement; const maxHeight = container.clientHeight*0.7; const height = (value/maxVal)*maxHeight; bar.style.height = height + 'px';
  switch(type){ case 'int': valueDisplay.textContent = Math.round(value); break; case 'percent': valueDisplay.textContent = value.toFixed(1)+'%'; break; case 'float': valueDisplay.textContent = value.toFixed(1); break; default: valueDisplay.textContent = value.toFixed(1);}
}
function makeLeftDraggable(barObj){
  let dragging=false; const wrapper = barObj.bar.parentElement;
  wrapper.addEventListener('mousedown', e=>{ dragging=true; e.preventDefault(); });
  document.addEventListener('mouseup', ()=>dragging=false);
  document.addEventListener('mousemove', e=>{
    if(!dragging) return;
    const container = wrapper.getBoundingClientRect();
    let height = container.bottom - e.clientY; height = Math.max(height,0); height = Math.min(height, container.height*0.7);
    let val = (height/(container.height*0.7))*barObj.max; val = Math.round(val/barObj.step)*barObj.step; val = Math.min(Math.max(val,0),barObj.max);
    if(barObj.id==='profit'){ profitBar.value = val; updateHeight(profitBar.bar, profitBar.display, val, profitBar.max, profitBar.type); const winRate = Math.round(100/(1 + val)*10)/10; breakevenBar.value = winRate; updateHeight(breakevenBar.bar, breakevenBar.display, winRate, breakevenBar.max, breakevenBar.type); return;}
    if(barObj.id==='breakeven'){ breakevenBar.value = val; updateHeight(breakevenBar.bar, breakevenBar.display, val, breakevenBar.max, breakevenBar.type); const profitVal = Math.min((100 - val)/val, profitBar.max); profitBar.value = Math.round(profitVal*10)/10; updateHeight(profitBar.bar, profitBar.display, profitBar.value, profitBar.max, profitBar.type); return;}
  });
  wrapper.addEventListener('wheel', e=>{
    e.preventDefault(); const dir = e.deltaY>0?-1:1; let val = barObj.value + barObj.step*dir; val = Math.round(val / barObj.step) * barObj.step; val = Math.min(Math.max(val,0),barObj.max);
    if(barObj.id==='profit'){ profitBar.value = val; updateHeight(profitBar.bar, profitBar.display, val, profitBar.max, profitBar.type); const winRate = Math.round(100/(1 + val)*10)/10; breakevenBar.value = winRate; updateHeight(breakevenBar.bar, breakevenBar.display, winRate, breakevenBar.max, breakevenBar.type); return;}
    if(barObj.id==='breakeven'){ breakevenBar.value = val; updateHeight(breakevenBar.bar, breakevenBar.display, val, breakevenBar.max, breakevenBar.type); const profitVal = Math.min((100 - val)/val, profitBar.max); profitBar.value = Math.round(profitVal*10)/10; updateHeight(profitBar.bar, profitBar.display, profitBar.value, profitBar.max, profitBar.type); return;}
  });
}
makeLeftDraggable(profitBar); makeLeftDraggable(breakevenBar);
updateHeight(profitBar.bar, profitBar.display, profitBar.value, profitBar.max, profitBar.type);
updateHeight(breakevenBar.bar, breakevenBar.display, breakevenBar.value, breakevenBar.max, breakevenBar.type);

// 右侧柱子及终值计算（复利方式）
const rightBars = [
  {bar: document.getElementById('rightBar1'), display: document.getElementById('val1'), value:1, step:1, max:100, type:'int'},
  {bar: document.getElementById('rightBar2'), display: document.getElementById('val2'), value:5, step:1, max:50, type:'percent'}, // 每次止损
  {bar: document.getElementById('rightBar3'), display: document.getElementById('val3'), value:10, step:1, max:100, type:'int'},
  {bar: document.getElementById('rightBar4'), display: document.getElementById('val4'), value:2, step:0.5, max:10, type:'float'},
  {bar: document.getElementById('rightBar5'), display: document.getElementById('val5'), value:50, step:1, max:100, type:'percent'}
];
function updateFinalResult() {
  const capital = rightBars[0].value;
  const stopLoss = rightBars[1].value;
  const trades = rightBars[2].value;
  const profitLossRatio = rightBars[3].value;
  const winRate = rightBars[4].value;

  if(trades === 0){ 
    document.getElementById('calcResult').textContent = formatTenThousand(capital); 
    return;
  }

  const winFraction = winRate / 100;
  const lossFraction = 1 - winFraction;
  const G = profitLossRatio * stopLoss / 100;
  const L = stopLoss / 100;
  const avgReturnPerTrade = winFraction * G - lossFraction * L;

  const finalValue = capital * Math.pow(1 + avgReturnPerTrade, trades);
  document.getElementById('calcResult').textContent = formatTenThousand(finalValue);
}

rightBars.forEach(barObj=>{
  let dragging=false; const wrapper = barObj.bar.parentElement; const barElem = barObj.bar;
  function updateBar(val){ barObj.value = val; updateHeight(barElem,barObj.display,val,barObj.max,barObj.type); updateFinalResult();}
  wrapper.addEventListener('mousedown', e=>{ dragging=true; e.preventDefault(); });
  document.addEventListener('mouseup', ()=>dragging=false);
  document.addEventListener('mousemove', e=>{ if(!dragging) return; const container = wrapper.getBoundingClientRect();
    let height = container.bottom - e.clientY; height = Math.max(height,0); height = Math.min(height, container.height*0.7);
    let val = (height/(container.height*0.7))*barObj.max; val = Math.round(val/barObj.step)*barObj.step; val = Math.min(Math.max(val,0),barObj.max); updateBar(val);
  });
  wrapper.addEventListener('wheel', e=>{ e.preventDefault(); const dir = e.deltaY>0?-1:1; let val = barObj.value + barObj.step*dir; val = Math.min(Math.max(val,0),barObj.max); val = Math.round(val/barObj.step)*barObj.step; updateBar(val); });
  updateBar(barObj.value);
});

// 导航栏模式切换
const modeToggle = document.getElementById('modeToggle');
modeToggle.addEventListener('click', ()=>{
  if(document.body.classList.contains('dark')){ document.body.classList.remove('dark'); document.body.classList.add('light');
    modeToggle.setAttribute('data-full','深色模式'); modeToggle.setAttribute('data-short','深');
  } else { document.body.classList.remove('light'); document.body.classList.add('dark'); modeToggle.setAttribute('data-full','浅色模式'); modeToggle.setAttribute('data-short','浅'); }
});
</script>

</body>
</html>
