<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>复利计算器 + 导航</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<style>
:root {
  --input-scroll-width: 108px; 
  --input-height: 32px;
  --scroll-height: 180px;
}

body {
  margin: 0;
  background: #111;
  color: #eee;
  font-family: Arial, sans-serif;
  overflow-x: hidden;
}

/* 容器布局 */
.container {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 10px;
}

/* 输入区 + 滚动条 */
.input-group {
  display: flex;
  align-items: center;
  margin: 8px 0;
}
.input-group input {
  width: var(--input-scroll-width);
  height: var(--input-height);
  text-align: center;
  font-size: 14px;
  margin-right: 10px;
}
.scroll-bar {
  width: 24px;
  height: var(--scroll-height);
  border-radius: 12px;
  background: #333;
  position: relative;
  overflow: hidden;
  touch-action: none;
}
.scroll-fill {
  position: absolute;
  bottom: 0;
  width: 100%;
  background: #4caf50;
  border-radius: 12px;
  height: 0;
  transition: height 0.1s;
}

/* 图表 */
canvas {
  max-width: 100%;
  margin-top: 15px;
  background: #222;
  border-radius: 8px;
  padding: 10px;
}

/* 左侧导航 */
#sidebar {
  position: fixed;
  top: 0;
  left: -30%;
  width: 30%;
  height: 100%;
  background: #222;
  color: #fff;
  transition: left 0.3s ease;
  display: flex;
  justify-content: center;
  align-items: center;
}
#sidebar.active {
  left: 0;
}
#sidebar ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
#sidebar li {
  margin: 15px 0;
  font-size: 18px;
}
</style>
</head>
<body>
<div id="sidebar">
  <ul>
    <li>盈亏比&胜率</li>
    <li>复利计算器</li>
    <li>设置</li>
  </ul>
</div>

<div class="container">
  <div class="input-group">
    <input id="principal" type="number" value="1000">
    <div class="scroll-bar" id="scroll-principal">
      <div class="scroll-fill"></div>
    </div>
  </div>
  <div class="input-group">
    <input id="rate" type="number" value="5">
    <div class="scroll-bar" id="scroll-rate">
      <div class="scroll-fill"></div>
    </div>
  </div>
  <div class="input-group">
    <input id="years" type="number" value="10">
    <div class="scroll-bar" id="scroll-years">
      <div class="scroll-fill"></div>
    </div>
  </div>

  <canvas id="chart"></canvas>
</div>

<script>
const principalInput = document.getElementById("principal");
const rateInput = document.getElementById("rate");
const yearsInput = document.getElementById("years");

const ctx = document.getElementById("chart").getContext("2d");
let chart;

function calculate() {
  const principal = parseFloat(principalInput.value);
  const rate = parseFloat(rateInput.value) / 100;
  const years = parseInt(yearsInput.value);

  const labels = [];
  const data = [];
  let amount = principal;

  for (let i = 1; i <= years; i++) {
    amount = amount * (1 + rate);
    labels.push(i + "年");
    data.push(amount.toFixed(2));
  }

  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [{
        label: "复利增长",
        data,
        borderColor: "#4caf50",
        backgroundColor: "rgba(76, 175, 80, 0.2)",
        fill: true
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { labels: { color: "#fff" } } },
      scales: {
        x: { ticks: { color: "#fff" } },
        y: { ticks: { color: "#fff" }, beginAtZero: false }
      }
    }
  });
}
calculate();

/* 滚动条逻辑 */
function setupScroll(input, scroll, min, max, id){
  const fill = scroll.querySelector('.scroll-fill');
  function updateFill(){
    const val = parseFloat(input.value)||min;
    const percent = (val-min)/(max-min)*100;
    fill.style.height = percent+"%";
  }
  updateFill();

  input.addEventListener('input', ()=>{
    calculate();
    updateFill();
  });

  let startY, startX, startVal;
  scroll.addEventListener('touchstart', e=>{
    e.preventDefault();
    fill.style.transition = ""; 
    startY = e.touches[0].clientY;
    startX = e.touches[0].clientX;
    startVal = parseFloat(input.value)||min;

    function moveHandler(ev){
      ev.preventDefault();
      const currentX = ev.touches[0].clientX;
      const currentY = ev.touches[0].clientY;
      const deltaX = currentX - startX;
      const deltaY = currentY - startY;

      const tolerance = 10; // 横向容忍区间

      // 横向滑动更大 且 超过容忍区间 → 判定为横向，不处理
      if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > tolerance) {
        return;
      }

      // 纵向滑动才更新数值
      let newVal = startVal - deltaY/(scroll.clientHeight)*(max-min);
      if(id==='rate') newVal = Math.round(newVal*2)/2;
      else newVal = Math.round(newVal);
      newVal = Math.min(Math.max(newVal,min),max);

      // 只有数值真正变化时才更新
      if (newVal !== parseFloat(input.value)) {
        input.value = newVal;
        calculate();
        updateFill();
      }
    }

    function endHandler(){
      let finalVal = parseFloat(input.value);
      if(id==='rate') finalVal = Math.round(finalVal*2)/2;
      else finalVal = Math.round(finalVal);
      finalVal = Math.min(Math.max(finalVal,min),max);
      input.value = finalVal;
      calculate();
      fill.style.transition = "height 0.1s";
      updateFill();
      document.removeEventListener('touchmove', moveHandler);
      document.removeEventListener('touchend', endHandler);
    }

    document.addEventListener('touchmove', moveHandler, {passive:false});
    document.addEventListener('touchend', endHandler);
  });
}

setupScroll(principalInput, document.getElementById("scroll-principal"), 100, 10000, 'principal');
setupScroll(rateInput, document.getElementById("scroll-rate"), 1, 20, 'rate');
setupScroll(yearsInput, document.getElementById("scroll-years"), 1, 50, 'years');

/* 左滑呼出导航 */
let touchStartX = 0;
let touchEndX = 0;
document.body.addEventListener('touchstart', e => {
  touchStartX = e.changedTouches[0].screenX;
});
document.body.addEventListener('touchend', e => {
  touchEndX = e.changedTouches[0].screenX;
  if (touchStartX - touchEndX < -50) {
    document.getElementById('sidebar').classList.add('active');
  }
  if (touchStartX - touchEndX > 50) {
    document.getElementById('sidebar').classList.remove('active');
  }
});
</script>
</body>
</html>
