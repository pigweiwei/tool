<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iPhone 风格深色滚轮</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    background: #1c1c1e;
    font-family: Arial, sans-serif;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 20px;
}

.result {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 20px;
    color: #fff;
}

.wheel-container {
    display: flex;
    gap: 40px;
    perspective: 1000px;
    margin-bottom: 20px;
}

.wheel-column {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
}

.wheel {
    width: 120px;
    height: 400px;
    overflow: hidden;
    border-radius: 20px;
    background: #2c2c2e;
    text-align: center;
    position: relative;
    -webkit-overflow-scrolling: touch; /* 实现惯性滚动 */
}

.wheel::before, .wheel::after {
    content: '';
    position: absolute;
    left: 0;
    width: 100%;
    height: 80px;
    pointer-events: none;
}
.wheel::before { top: 0; background: linear-gradient(to bottom, #1c1c1e, transparent); }
.wheel::after { bottom: 0; background: linear-gradient(to top, #1c1c1e, transparent); }

.wheel-content {
    overflow-y: scroll;
    height: 100%;
    padding: calc(50% - 40px) 0; /* 让选中项居中 */
    scroll-snap-type: y mandatory;
}

.wheel-content div {
    height: 80px;
    line-height: 80px;
    scroll-snap-align: center;
    font-size: 32px;
    transition: transform 0.2s, color 0.2s, opacity 0.2s;
    transform-origin: center center -40px;
}

.wheel-line {
    position: absolute;
    top: 50%;
    left: 0;
    width: 100%;
    height: 40px;
    background: rgba(255,59,48,0.2);
    pointer-events: none;
    border-radius: 8px;
}

.wheel-content div.selected {
    color: #ff3b30 !important;
    font-weight: bold !important;
}

.wheel-label {
    margin-top: 10px;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
    color: #fff;
}
</style>
</head>
<body>

<div class="result" id="totalProfit">总仓盈亏：0</div>

<div class="wheel-container">
    <div class="wheel-column">
        <div class="wheel" id="ratioWheel">
            <div class="wheel-content"></div>
            <div class="wheel-line"></div>
        </div>
        <div class="wheel-label">仓位</div>
    </div>
    <div class="wheel-column">
        <div class="wheel" id="multiplierWheel">
            <div class="wheel-content"></div>
            <div class="wheel-line"></div>
        </div>
        <div class="wheel-label">盈亏</div>
    </div>
</div>

<script>
// 左侧仓位分数
const ratios = ['1','1/2','1/3','1/4','1/5','1/6','1/7','1/8','1/9','1/10'];
// 右侧倍数 0.5 到 20
const multipliers = Array.from({length:40}, (_,i)=>(0.5*(i+1)).toFixed(1));

const ratioWheel = document.querySelector('#ratioWheel .wheel-content');
const multiplierWheel = document.querySelector('#multiplierWheel .wheel-content');
const totalProfitDisplay = document.getElementById('totalProfit');

// 填充滚轮
function populateWheel(wheel, items){
    items.forEach(item=>{
        const div = document.createElement('div');
        div.textContent = item;
        wheel.appendChild(div);
    });
}
populateWheel(ratioWheel, ratios);
populateWheel(multiplierWheel, multipliers);

// 将分数字符串转换成数字
function parseRatio(str){
    if(str.includes('/')){
        const [num, denom] = str.split('/').map(Number);
        return num/denom;
    } else return parseFloat(str);
}

// 更新选中状态和总仓盈亏
function updateSelection(){
    [ratioWheel, multiplierWheel].forEach(wheel=>{
        Array.from(wheel.children).forEach((child, i)=>{
            child.classList.remove('selected');
            const offset = Math.round((wheel.scrollTop)/80) - i;
            const scale = Math.max(0.5, 1 - Math.abs(offset)*0.2);
            const opacity = Math.max(0.3, 1 - Math.abs(offset)*0.3);
            const rotateX = offset * 25;
            child.style.transform = `scale(${scale}) rotateX(${rotateX}deg)`;
            child.style.opacity = opacity;
            if(offset === 0) child.classList.add('selected');
        });
    });

    const ratio = parseRatio(ratios[Math.round(ratioWheel.scrollTop/80)]);
    const multiplier = parseFloat(multipliers[Math.round(multiplierWheel.scrollTop/80)]);
    totalProfitDisplay.textContent = `总仓盈亏：${(ratio*multiplier).toFixed(2)}`;
}

// 吸附滚动到最近刻度
function snapToClosest(wheel){
    const index = Math.round(wheel.scrollTop / 80);
    wheel.scrollTo({top: index*80, behavior: 'smooth'});
    updateSelection();
}

// 绑定滚轮滑动和拖动事件
function attachWheel(wheel){
    let lastY = 0, isMouseDown = false;

    const moveHandler = (delta)=>{
        wheel.scrollTop += delta;
        updateSelection();
    }

    wheel.addEventListener('touchstart', e=>{ lastY = e.touches[0].clientY; });
    wheel.addEventListener('touchmove', e=>{
        const delta = lastY - e.touches[0].clientY;
        lastY = e.touches[0].clientY;
        moveHandler(delta);
        e.preventDefault();
    });
    wheel.addEventListener('touchend', e=>{ snapToClosest(wheel); });

    wheel.addEventListener('mousedown', e=>{
        lastY = e.clientY;
        isMouseDown = true;
        e.preventDefault();
    });
    window.addEventListener('mousemove', e=>{
        if(isMouseDown){
            const delta = lastY - e.clientY;
            lastY = e.clientY;
            moveHandler(delta);
        }
    });
    window.addEventListener('mouseup', e=>{
        if(isMouseDown){
            isMouseDown = false;
            snapToClosest(wheel);
        }
    });
}

attachWheel(ratioWheel);
attachWheel(multiplierWheel);
updateSelection();
</script>
</body>
</html>
